<html>
<head>
    <title>Upload Example</title>
    <style type="text/css" media="screen">
        #progress {
            width: 500px;
            border: 1px solid black;
            position: relative;
            padding: 3px;
        }

        #percent {
            position: absolute;
            left: 50%;
        }

        #bar {
            height: 20px;
            background-color: green;
            width: 0%;
        }
    </style>
</head>
<body>
<br><br>

<h3>Add Project</h3>

<form id="newProjectForm"
      enctype="multipart/form-data"
      action="/project/new"
      method="post">
    Name: <input type="text" id="pNameInput" name="name" width="100"/><br>
    Platform:
    <select id="pPlatformInput">
        <option>Unity</option>
        <option>Android</option>
        <option>iOS</option>
        <option>Cocos2dx</option>
    </select><br>
    <input id="newProjectFormSubmit" type="submit" value="Add"/>
</form>

<br><br>
<hr>
<h3>Add Release</h3>
<select id="projects">
    <option value="" disabled selected>Select project</option>
</select>

<ul id="releases">

</ul>

<div>
    Release: <input type="text" width="100" id="release"/><br>
    <input id="latestVal" type="checkbox" checked /> Latest
</div>

<form id="uploadForm"
      enctype="multipart/form-data"
      action="/api/upload"
      method="post">
    <input type="file" id="userFileInput" name="userFile"/>
</form>
<span id="status"></span>

<div id="progress">
    <span id="percent">0%</span>

    <div id="bar"></div>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="./js/upload.js"></script>

<script>
    $(function () {
        var refreshProjectsList = function () {
            $.get('/projects', function (data) {
                if (data) {
                    var projects = data.projects;
                    $('#projects')
                            .find('option[value!=""]')
                            .remove();
                    projects.forEach(function (p) {

                        $('#projects')
                                .append($("<option></option>")
                                        .attr("value", p._id)
                                        .text(p._id));
                    });
                }
            });
        };
        refreshProjectsList();

        $('#projects').change(function () {
            $.get('/project/' + $('#projects').val(), function (data) {
                if (data.success) {
                    var project = data.project;
                    var releases = project.releases;
                    $('#releases')
                            .find('li')
                            .remove();
                    releases.forEach(function (r) {
                        var rText = '<a href="/project/' + project._id + '/' + r + '">' + r + '</a>';
                        if (r===project.latest) {
                            rText += ' <b style="color: green"><em>(latest)</em></b>';
                        }
                        $('#releases')
                                .append($("<li></li>")
                                .html(rText));
                    });
                }
            });
        });

        $('input#newProjectFormSubmit').click(function () {
            var projectName = $('#pNameInput').val();
            if (!projectName) {
                alert('Please provide a project name.');
                return false;
            }
            var projectPlatform = $('#pPlatformInput').val();
            if (!projectPlatform) {
                alert('Please provide a project platform.');
                return false;
            }
            $.ajax({ type: 'POST', url: '/project/new', data: JSON.stringify({ name: projectName, platform: projectPlatform }),
                        success: function (data) {
                            refreshProjectsList();
                            alert(projectName + ' added successfully.');
                        },
                        error: function (data) {
                            alert(data.responseJSON.error);
                        },
                        contentType: 'application/json' }
            );
            return false;
        });

    });
</script>

</body>
</html>